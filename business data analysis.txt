
-- Q1. What is the total revenue generated by male vs. female customers?
SELECT Gender,
       SUM(purchase_amount) AS revenue
FROM Customers
GROUP BY Gender;


-- Q2. Which customers used a discount but still spent more than the average purchase amount? 
SELECT 
    customer_id, purchase_amount
FROM
    customers
WHERE
    discount_applied = 'yes'
        AND purchase_amount >= (SELECT 
            AVG(purchase_amount)
        FROM
            customers)
-- which are the top 5 products with highest average review rating ?
SELECT 
    item_purchased,
    ROUND(AVG(review_rating), 2) AS `average_product`
FROM customers
GROUP BY item_purchased
ORDER BY AVG(review_rating) DESC
LIMIT 5;

-- Q4. Compare the average Purchase Amounts between Standard and Express Shipping. 
SELECT 
    shipping_type, ROUND(AVG(purchase_amount), 2)
FROM
    customers
WHERE
    shipping_type IN ('standard' , 'express')
GROUP BY shipping_type ;
-- Q5. Do subscribed customers spend more? Compare average spend and total revenue 
SELECT
    subscription_status,
    COUNT(customer_id) AS total_customers,
    AVG(purchase_amount) AS avg_spend,
    SUM(purchase_amount) AS total_revenue
FROM customers
GROUP BY subscription_status
ORDER BY total_revenue DESC, avg_spend DESC;

-- Q6. Which 5 products have the highest percentage of purchases with discounts applied?
select item_purchased,
round(100*sum(case when discount_applied="Yes" then 1 else 0 end)/count(*),2) as discount_rate 
from customers
group by item_purchased 
order by discount_rate desc 
limit 5 ;
-- Q7. Segment customers into New, Returning, and Loyal based on their total 
WITH customer_types AS (
    SELECT
        customer_id,
        previous_purchases,
        CASE
            WHEN previous_purchases = 1 THEN 'new'
            WHEN previous_purchases BETWEEN 2 AND 5 THEN 'returning'
            ELSE 'loyal'
        END AS customer_segment
    FROM customers
)
SELECT
    customer_segment,
    COUNT(*) AS number_of_customers
FROM customer_types
GROUP BY customer_segment;


-- Q8. What are the top 3 most purchased products within each category? 
WITH item_counts AS (
    SELECT category,
           item_purchased,
           COUNT(customer_id) AS total_orders,
           ROW_NUMBER() OVER (PARTITION BY category ORDER BY COUNT(customer_id) DESC) AS item_rank
    FROM customers
    GROUP BY category, item_purchased
)
SELECT item_rank,category, item_purchased, total_orders
FROM item_counts
WHERE item_rank <=3;

-- Q9. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
SELECT 
    subscription_status, COUNT(customer_id) AS repeat_buyers
FROM
    customers
WHERE
    previous_purchases > 5
GROUP BY subscription_status;

-- Q10. What is the revenue contribution of each age group? 
SELECT 
    age_group, SUM(purchase_amount) AS total_revenue
FROM
    customers
GROUP BY age_group
ORDER BY total_revenue DESC;


ALTER USER 'root'@'localhost'
IDENTIFIED WITH mysql_native_password
BY 'Manish66^';

FLUSH PRIVILEGES;

